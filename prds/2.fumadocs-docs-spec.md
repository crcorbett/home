Install Fumadocs with TanStack Start in apps/docs using Bun, migrate existing markdown files as documentation, then write DONE into the record

--completion-promise=DONE

---

## Overview

Set up a vanilla Fumadocs documentation site using TanStack Start in the `apps/docs` directory. This will serve as the documentation hub for the monorepo, with the existing markdown files (`typescript.md` and `phantom-dependencies.md`) as the initial content.

## Goals

- Vanilla Fumadocs installation following official documentation exactly
- Use Bun as the package manager (consistent with monorepo)
- Minimal configuration - no bells and whistles
- Use Playwriter to debug the installation during development

## Prerequisites

The monorepo already has:

- Bun workspaces configured
- Tailwind CSS 4 available
- TanStack Start/Router patterns in `apps/web`
- TypeScript configuration with live types (`@packages/source` condition)

## Installation Steps

### 1. Create apps/docs Directory Structure

```
apps/docs/
├── content/
│   └── docs/
│       ├── index.mdx
│       ├── typescript.mdx
│       └── phantom-dependencies.mdx
├── src/
│   ├── lib/
│   │   ├── source.ts
│   │   └── layout.shared.tsx
│   └── routes/
│       ├── __root.tsx
│       ├── index.tsx
│       ├── docs/
│       │   └── $.tsx
│       └── api/
│           └── search.ts
├── public/
├── source.config.ts
├── vite.config.ts
├── tsconfig.json
├── package.json
└── .gitignore
```

### 2. Install Dependencies (with Bun)

```bash
cd apps/docs
bun add fumadocs-core fumadocs-ui fumadocs-mdx @types/mdx
bun add @tanstack/react-router @tanstack/react-start react react-dom
bun add -D @tailwindcss/vite @vitejs/plugin-react typescript vite vite-tsconfig-paths
```

### 3. Configure MDX Source (source.config.ts)

```ts
import { defineDocs } from 'fumadocs-mdx/config';

export const docs = defineDocs({
  dir: 'content/docs',
});
```

### 4. Configure Vite (vite.config.ts)

```ts
import tailwindcss from "@tailwindcss/vite";
import { tanstackStart } from "@tanstack/react-start/plugin/vite";
import viteReact from "@vitejs/plugin-react";
import { defineConfig } from "vite";
import tsConfigPaths from "vite-tsconfig-paths";
import mdx from "fumadocs-mdx/vite";
import * as MdxConfig from "./source.config";

export default defineConfig({
  server: {
    port: 3001,
  },
  resolve: {
    conditions: ["@packages/source"],
  },
  plugins: [
    mdx(MdxConfig),
    tailwindcss(),
    tsConfigPaths({
      projects: ["./tsconfig.json"],
    }),
    tanstackStart({
      srcDirectory: "src",
    }),
    viteReact(),
  ],
});
```

### 5. Configure TypeScript (tsconfig.json)

```json
{
  "extends": "../../tsconfig.base.json",
  "compilerOptions": {
    "noEmit": true,
    "composite": false,
    "baseUrl": ".",
    "paths": {
      "$/*": ["./src/*"],
      "@/*": ["./src/*"],
      "fumadocs-mdx:collections/*": [".source/*"]
    }
  },
  "include": ["**/*.ts", "**/*.tsx", ".source/**/*.ts"]
}
```

### 6. Create Source Loader (src/lib/source.ts)

```ts
import { docs } from "fumadocs-mdx:collections/server";
import { loader } from "fumadocs-core/source";

export const source = loader({
  baseUrl: "/docs",
  source: docs.toFumadocsSource(),
});
```

### 7. Create Layout Options (src/lib/layout.shared.tsx)

```tsx
import type { BaseLayoutProps } from "fumadocs-ui/layouts/shared";

export function baseOptions(): BaseLayoutProps {
  return {
    nav: {
      title: "Documentation",
    },
  };
}
```

### 8. Create Root Route (src/routes/\_\_root.tsx)

```tsx
import type * as React from "react";
import { createRootRoute, HeadContent, Scripts } from "@tanstack/react-router";
import { RootProvider } from "fumadocs-ui/provider/tanstack";
import "$/styles/app.css";

export const Route = createRootRoute({
  component: RootComponent,
  shellComponent: RootDocument,
});

function RootComponent() {
  return <></>;
}

function RootDocument({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" suppressHydrationWarning>
      <head>
        <HeadContent />
      </head>
      <body className="flex flex-col min-h-screen">
        <RootProvider>{children}</RootProvider>
        <Scripts />
      </body>
    </html>
  );
}
```

### 9. Create Docs Route (src/routes/docs/$.tsx)

Follow the Fumadocs TanStack Start documentation exactly for the docs splat route with:

- Server loader using `createServerFn`
- Browser collections client loader
- `DocsLayout`, `DocsPage`, `DocsBody`, `DocsTitle`, `DocsDescription` components
- Default MDX components

### 10. Create Search API Route (src/routes/api/search.ts)

```ts
import { createFileRoute } from "@tanstack/react-router";
import { source } from "@/lib/source";
import { createFromSource } from "fumadocs-core/search/server";

const server = createFromSource(source, {
  language: "english",
});

export const Route = createFileRoute("/api/search")({
  server: {
    handlers: {
      GET: async ({ request }) => server.GET(request),
    },
  },
});
```

### 11. Create Styles (src/styles/app.css)

```css
@import "tailwindcss";
@import "fumadocs-ui/css/neutral.css";
@import "fumadocs-ui/css/preset.css";
```

### 12. Migrate Existing Documentation

Convert existing markdown files to MDX format with proper frontmatter:

**content/docs/index.mdx**

```mdx
---
title: Documentation
description: Technical documentation for the monorepo
---

Welcome to the documentation.
```

**content/docs/typescript.mdx**

- Move from `apps/docs/content/typescript.md`
- Add frontmatter with title and description

**content/docs/phantom-dependencies.mdx**

- Move from `apps/docs/content/phantom-dependencies.md`
- Add frontmatter with title and description

### 13. Create package.json

```json
{
  "name": "docs",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "bun --bun vite dev --host",
    "build": "bun --bun vite build",
    "preview": "bun --bun vite preview",
    "check-types": "tsc --noEmit"
  },
  "dependencies": {
    "@tanstack/react-router": "^1.142.7",
    "@tanstack/react-start": "^1.142.7",
    "fumadocs-core": "latest",
    "fumadocs-mdx": "latest",
    "fumadocs-ui": "latest",
    "react": "catalog:react",
    "react-dom": "catalog:react"
  },
  "devDependencies": {
    "@tailwindcss/vite": "^4.1.18",
    "@types/mdx": "^2.0.13",
    "@types/react": "catalog:react",
    "@types/react-dom": "catalog:react",
    "@vitejs/plugin-react": "^4.6.0",
    "typescript": "catalog:typescript",
    "vite": "^7.1.7",
    "vite-tsconfig-paths": "^5.1.4"
  }
}
```

### 14. Update Root tsconfig.json

Add docs to project references:

```json
{
  "references": [
    { "path": "./apps/web" },
    { "path": "./apps/docs" },
    { "path": "./packages/core" },
    { "path": "./packages/api" },
    { "path": "./packages/ui" }
  ]
}
```

### 15. Create .gitignore

```
node_modules/
dist/
.output/
.source/
*.local
```

## Debugging with Playwriter

Use Playwriter browser automation to:

1. Navigate to http://localhost:3001 after starting dev server
2. Verify the documentation renders correctly
3. Test navigation between docs pages
4. Verify search functionality works

## Success Criteria

- `bun run dev` starts the docs site on port 3001
- Documentation pages render with Fumadocs UI styling
- Existing markdown content is accessible at `/docs/typescript` and `/docs/phantom-dependencies`
- Search API works at `/api/search`
- No TypeScript errors (`bun run check-types` passes)
- Build succeeds (`bun run build`)

## Notes

- Keep the installation vanilla - no additional themes or plugins
- Follow Fumadocs documentation exactly for TanStack Start
- Use port 3001 to avoid conflict with main web app on port 3000
- The `.source` folder is auto-generated and should be gitignored
